<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="1.10.0">
  <bpmn:collaboration id="Collaboration_0uir125">
    <bpmn:participant id="Participant_0mt1n95" name="Einwohnerkontrollsystem" processRef="RelocationMessageHandlingProcess" />
    <bpmn:participant id="Participant_1wukrk4" name="Umzugsplattform" />
    <bpmn:messageFlow id="MessageFlow_0sae0dy" name="Umzugs-, Wegzugs- oder Zuzugsmeldung" sourceRef="Participant_1wukrk4" targetRef="StartEventProcessStarted">
      <bpmn:documentation>eCH-0194:platformMoveOut, eCH-0194:platformMoveIn oder eCH-0194:platformMoveData</bpmn:documentation>
    </bpmn:messageFlow>
    <bpmn:messageFlow id="MessageFlow_0p5n3l1" name="Fachliche Quittierung" sourceRef="EndEventProcessEnded" targetRef="Participant_1wukrk4">
      <bpmn:documentation>eCH-0058:eventReport</bpmn:documentation>
    </bpmn:messageFlow>
  </bpmn:collaboration>
  <bpmn:process id="RelocationMessageHandlingProcess" name="Umzugsmeldung verarbeiten" isExecutable="true">
    <bpmn:sequenceFlow id="SequenceFlow_0visc5j" name="Abgelehnt" sourceRef="ExclusiveGateway_17bi2ju" targetRef="Task_1a6hmrf">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!requestApproved}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_0p61xpr" name="Bewilligt" sourceRef="ExclusiveGateway_17bi2ju" targetRef="Task_0hcaizb">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${requestApproved}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1m635hr" sourceRef="StartEventProcessStarted" targetRef="Task_07g0pyt" />
    <bpmn:startEvent id="StartEventProcessStarted" name="Umzugs-, Wegzugs- oder Zuzugsmeldung erhalten">
      <bpmn:documentation><![CDATA[Der WebService-Controller hat basierend auf dem Aufruf der entsprechenden WebService-Operation eine neue Prozessinstanz erstellt und ihr folgende Prozessvariablen übergeben:
- (vn)
- firstName
- officialName
- sex
- dateOfBirth
- emailAddress
- phoneNumber
- (street)
- (houseNumber)
- (swissZipCode)
- (town)
- (movingDate)
- (administrativDwellingNumber)
- (departureDate)
- (arrivalDate)
]]></bpmn:documentation>
      <bpmn:outgoing>SequenceFlow_1m635hr</bpmn:outgoing>
      <bpmn:messageEventDefinition messageRef="Message_0361g3h" />
    </bpmn:startEvent>
    <bpmn:serviceTask id="Task_07g0pyt" name="Daten für Prüfung zusammen stellen" camunda:delegateExpression="#{concatenateDataForReviewAdapter}">
      <bpmn:documentation><![CDATA[Einzelne Variablen zu einer Variable zusammensetzen
Im nächsten User Task werden die Personalien, die Kontaktangaben und die je nach Umzug, Wegzug oder Zuzug spezifischen Daten benötigt für die Prüfung. Da diese lediglich zum Anschauen benötigt werden, soll eine neue Variable dataToReview vom Typ String durch Concatenation der übrigen Variablen gebildet werden. Diese hat dann in folgenden Inhalt:
"Bitte prüfen Sie, ob der folgende Antrag zu {{Umzug/Wegzug/Zuzug}} bewilligt werden kann.

Angaben zur meldepflichtigen Person:
- Vorname(n): {{eCH-0044:firstName}}
- Nachname: {{eCH-0044:officialName}}
- Geschlecht: {{eCH-0044:sex, übersetzt in String}}
- Geburtsdatum: {{eCH-0044:dateOfBirth, übersetzt in DD.MM.JJJJ}}
- AHV-Nummer: {{eCH-0044:vn}}

Angaben zum {{Umzug/Wegzug/Zuzug}}:
FALLS WEGZUG: Zuzugsgemeinde: {{eCH-0194:destinationMunicipality > eCH-0007:municipalityName}}
- Datum:  {{eCH-0194:departureDate / eCH-0011:movingDate / eCH-0194:arrivalDate}}
FALLS UMZUG oder ZUZUG: Identifikation der neuen Wohnung: {{eCH-0194:dwellingIdentification > eCH-0185:administrativDwellingNumber}}

Kontaktangaben für allfällige Rückfragen:
- E-Mail-Adresse: {{eCH-0185:emailAddress}}
- Telefon: {{eCH-0185:phoneNumber}}""
]]></bpmn:documentation>
      <bpmn:incoming>SequenceFlow_1m635hr</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_04epzhk</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="ExclusiveGateway_17bi2ju" name="Prüfergebnis?">
      <bpmn:incoming>SequenceFlow_1agz48n</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0p61xpr</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0visc5j</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0fqy019">
      <bpmn:incoming>SequenceFlow_1cn0wbi</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_05i5lfn</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1cgqm8v</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_05i5lfn" sourceRef="Task_1a6hmrf" targetRef="ExclusiveGateway_0fqy019" />
    <bpmn:sequenceFlow id="SequenceFlow_1cn0wbi" sourceRef="Task_0hcaizb" targetRef="ExclusiveGateway_0fqy019" />
    <bpmn:sequenceFlow id="SequenceFlow_1cgqm8v" sourceRef="ExclusiveGateway_0fqy019" targetRef="EndEventProcessEnded" />
    <bpmn:scriptTask id="Task_0hcaizb" name="Quittierungs-meldung als Durchgeführt setzen" scriptFormat="JavaScript">
      <bpmn:documentation>Code wird auf 2 (Durchgeführt) gesetzt</bpmn:documentation>
      <bpmn:incoming>SequenceFlow_0p61xpr</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1cn0wbi</bpmn:outgoing>
      <bpmn:script><![CDATA[execution.setVariable("code",2);]]></bpmn:script>
    </bpmn:scriptTask>
    <bpmn:scriptTask id="Task_1a6hmrf" name="Quittierungs-meldung als Abgelehnt setzen" scriptFormat="JavaScript">
      <bpmn:documentation>Code wird auf 1 (Abgelehnt) gesetzt, textGerman auf den Wert der Variable requestDeclinedReason.</bpmn:documentation>
      <bpmn:incoming>SequenceFlow_0visc5j</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_05i5lfn</bpmn:outgoing>
      <bpmn:script><![CDATA[execution.setVariable("code",1);
execution.setVariable("textGerman",requestDeclinedReason);]]></bpmn:script>
    </bpmn:scriptTask>
    <bpmn:endEvent id="EndEventProcessEnded" name="Fachliche Quittierung gesendet">
      <bpmn:documentation><![CDATA[Dem WebService-Controller werden folgende Prozessvariablen zurück gegeben:
- code
- (textGerman)
]]></bpmn:documentation>
      <bpmn:incoming>SequenceFlow_1cgqm8v</bpmn:incoming>
      <bpmn:messageEventDefinition />
    </bpmn:endEvent>
    <bpmn:userTask id="Task_06du9cw" name="Wegzug, Zuzug oder Umzug prüfen" camunda:formKey="embedded:app:forms/checkMoveEligibility.html" camunda:candidateGroups="einwohnerkontrolle">
      <bpmn:documentation><![CDATA[Dieser Task wird für einen Einwohneramt-Mitarbeit generiert, respektive für eine Gruppe
Zunächst wird die Variable dataToReview  in einem <p>-Element dargestellt. Dann gibt es folgende Felder:
Antrag bewilligen?
  requestApproved
  Boolean
  checkbox
Ablehnungsgrund
  requestDeclinedReason
  String
  textarea (Optional)
]]></bpmn:documentation>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_04epzhk" sourceRef="Task_07g0pyt" targetRef="Task_1vz1jn0" />
    <bpmn:scriptTask id="Task_1vz1jn0" name="Temp für Aufgabe 3 User Task-Eingaben simulieren" scriptFormat="JavaScript">
      <bpmn:incoming>SequenceFlow_04epzhk</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1agz48n</bpmn:outgoing>
      <bpmn:script><![CDATA[execution.setVariable("requestApproved",true);]]></bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="SequenceFlow_1agz48n" sourceRef="Task_1vz1jn0" targetRef="ExclusiveGateway_17bi2ju" />
  </bpmn:process>
  <bpmn:message id="Message_0361g3h" name="newPlatformMoveMessage" />
  <bpmn:message id="Message_1dko3cc" name="newPlatformMoveMessage" />
  <bpmn:message id="Message_03m7i9t" name="newPlatformMoveInMessage" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_0uir125">
      <bpmndi:BPMNShape id="Participant_0mt1n95_di" bpmnElement="Participant_0mt1n95">
        <dc:Bounds x="-28" y="19" width="905" height="293" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1m635hr_di" bpmnElement="SequenceFlow_1m635hr">
        <di:waypoint xsi:type="dc:Point" x="76" y="155" />
        <di:waypoint xsi:type="dc:Point" x="139" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="62.5" y="134" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="StartEvent_1t8ippb_di" bpmnElement="StartEventProcessStarted">
        <dc:Bounds x="40" y="137" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="19" y="173" width="80" height="60" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_0gb1mdh_di" bpmnElement="Participant_1wukrk4">
        <dc:Bounds x="-28" y="-123" width="905" height="60" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="MessageFlow_0sae0dy_di" bpmnElement="MessageFlow_0sae0dy">
        <di:waypoint xsi:type="dc:Point" x="58" y="-63" />
        <di:waypoint xsi:type="dc:Point" x="58" y="137" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="84" y="-47" width="80" height="48" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="MessageFlow_0p5n3l1_di" bpmnElement="MessageFlow_0p5n3l1">
        <di:waypoint xsi:type="dc:Point" x="821" y="137" />
        <di:waypoint xsi:type="dc:Point" x="821" y="-63" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="754" y="-34.999999999999964" width="56" height="24" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_01l0zzf_di" bpmnElement="Task_06du9cw" bioc:stroke="#1E88E5" bioc:fill="#BBDEFB">
        <dc:Bounds x="285" y="212" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_17bi2ju_di" bpmnElement="ExclusiveGateway_17bi2ju" isMarkerVisible="true">
        <dc:Bounds x="428" y="130" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="417" y="103" width="72" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0p61xpr_di" bpmnElement="SequenceFlow_0p61xpr">
        <di:waypoint xsi:type="dc:Point" x="478" y="155" />
        <di:waypoint xsi:type="dc:Point" x="552" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="493.4637681159421" y="134" width="42" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0visc5j_di" bpmnElement="SequenceFlow_0visc5j">
        <di:waypoint xsi:type="dc:Point" x="453" y="180" />
        <di:waypoint xsi:type="dc:Point" x="453" y="252" />
        <di:waypoint xsi:type="dc:Point" x="552" y="252" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="466.142" y="230" width="53" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1cn0wbi_di" bpmnElement="SequenceFlow_1cn0wbi">
        <di:waypoint xsi:type="dc:Point" x="652" y="155" />
        <di:waypoint xsi:type="dc:Point" x="701" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="631.5" y="134" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0fqy019_di" bpmnElement="ExclusiveGateway_0fqy019" isMarkerVisible="true">
        <dc:Bounds x="701" y="130" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="681" y="184" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1cgqm8v_di" bpmnElement="SequenceFlow_1cgqm8v">
        <di:waypoint xsi:type="dc:Point" x="751" y="155" />
        <di:waypoint xsi:type="dc:Point" x="803" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="732" y="134" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_05i5lfn_di" bpmnElement="SequenceFlow_05i5lfn">
        <di:waypoint xsi:type="dc:Point" x="652" y="252" />
        <di:waypoint xsi:type="dc:Point" x="726" y="252" />
        <di:waypoint xsi:type="dc:Point" x="726" y="180" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="644" y="231" width="90" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_1il3cd2_di" bpmnElement="Task_07g0pyt">
        <dc:Bounds x="139" y="115" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0v79ccl_di" bpmnElement="EndEventProcessEnded">
        <dc:Bounds x="803" y="137" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="795" y="173" width="56" height="36" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ScriptTask_0lgtwjk_di" bpmnElement="Task_0hcaizb">
        <dc:Bounds x="552" y="115" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ScriptTask_0pakt5a_di" bpmnElement="Task_1a6hmrf">
        <dc:Bounds x="552" y="212" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_04epzhk_di" bpmnElement="SequenceFlow_04epzhk">
        <di:waypoint xsi:type="dc:Point" x="239" y="155" />
        <di:waypoint xsi:type="dc:Point" x="285" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="262" y="134" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_050fykt_di" bpmnElement="Task_1vz1jn0">
        <dc:Bounds x="285" y="115" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1agz48n_di" bpmnElement="SequenceFlow_1agz48n">
        <di:waypoint xsi:type="dc:Point" x="385" y="155" />
        <di:waypoint xsi:type="dc:Point" x="428" y="155" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="406.5" y="134" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
